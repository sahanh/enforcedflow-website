---
import { getCollection, render } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import ExtensionLayout from '~/layouts/ExtensionLayout.astro';

export const getStaticPaths = (async () => {
  const extensions = await getCollection('extensions');

  return extensions.map((extension) => {
    // Handle both flat files (simple-round-robin) and nested folders (advanced-round-robin/index)
    const slug = extension.id.replace('/index', '');

    return {
      params: { slug },
      props: { extension },
    };
  });
}) satisfies GetStaticPaths;

const { extension } = Astro.props;
const { Content } = await render(extension);

// Get setup guides from frontmatter
const setupGuides = extension.data.setupGuides || [];
---

<ExtensionLayout title={extension.data.title} description={extension.data.description} image={extension.data.image}>
  <Content />

  <div slot="sidebar">
    {
      setupGuides.length > 0 && (
        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-6 mb-6">
          <h3 class="font-bold text-lg mb-4">Setup Guides</h3>
          <ul class="space-y-2">
            {setupGuides.map(({ label, href }) => (
              <li>
                <a
                  href={href}
                  class="text-blue-600 dark:text-blue-400 hover:underline"
                  target={href.startsWith('http') ? '_blank' : undefined}
                  rel={href.startsWith('http') ? 'noopener noreferrer' : undefined}
                >
                  → {label}
                </a>
              </li>
            ))}
          </ul>
        </div>
      )
    }

    <!-- <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-6">
      <h3 class="font-bold text-lg mb-4">Quick Links</h3>
      <ul class="space-y-2">
        <li>
          <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">
            → API Documentation
          </a>
        </li>
        <li>
          <a href="/" class="text-blue-600 dark:text-blue-400 hover:underline">
            → All Extensions
          </a>
        </li>
      </ul>
    </div> -->
  </div>
</ExtensionLayout>
