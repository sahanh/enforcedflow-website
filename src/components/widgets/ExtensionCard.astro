---
import { getCollection } from 'astro:content';

export interface Props {
  title: string;
  description: string;
  icon?: string;
  extensionSlug: string;
  class?: string;
}

const { title, description, icon, extensionSlug, class: className = '' } = Astro.props;

// Check if guides exist for this extension
const extensionGuides = await getCollection('extensionGuides');
const hasZapierGuide = extensionGuides.some(
  (guide) => guide.data.extension === extensionSlug && guide.data.platform === 'zapier'
);
const hasMakeGuide = extensionGuides.some(
  (guide) => guide.data.extension === extensionSlug && guide.data.platform === 'make'
);
const hasAnyGuide = hasZapierGuide || hasMakeGuide;
---

<div
  class={`bg-white dark:bg-slate-900 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow flex flex-col h-full ${className}`}
>
  {
    icon && (
      <div class="mb-4">
        <span class="text-4xl">{icon}</span>
      </div>
    )
  }

  <h3 class="text-2xl font-bold font-heading mb-3">
    {title}
  </h3>

  <p class="text-muted dark:text-slate-400 flex-grow">
    {description}
  </p>

  <div class="mt-6 flex flex-wrap gap-2">
    {
      hasAnyGuide ? (
        <>
          {hasZapierGuide && (
            <a
              href={`/extensions/${extensionSlug}/guides/zapier/setup`}
              class="inline-block px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
            >
              Zapier Guide
            </a>
          )}
          {hasMakeGuide && (
            <a
              href={`/extensions/${extensionSlug}/guides/make/setup`}
              class="inline-block px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
            >
              Make.com Guide
            </a>
          )}
        </>
      ) : (
        <a
          href={`/extensions/${extensionSlug}`}
          class="inline-block px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors"
        >
          Learn More
        </a>
      )
    }
  </div>
</div>
